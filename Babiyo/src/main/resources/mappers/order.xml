<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mealmaker.babiyo.order">

<resultMap type="orderDto" id="orderResultMap">
<id column="NO" property="no"/>
<result column="NO" property="no"/>
<result column="MEMBER_ID" property="memberId"/>
<result column="ORDER_DATE" property="orderDate" javaType="java.util.Date"/>
<result column="TOTAL_PRICE" property="totalPrice"/>
<result column="RECEIVER_NAME" property="receiverName"/>
<result column="RECEIVER_PHONE" property="receiverPhone"/>
<result column="POST" property="post"/>
<result column="ADDRESS" property="address"/>
<result column="ADDRESS_DETAIL" property="addressDetail"/>
<result column="REQUEST" property="request"/>
<result column="STATE_CODE" property="stateCode"/>
</resultMap>

<resultMap type="com.mealmaker.babiyo.product.model.ProductDto" id="productResultMap">
<id column="NO" property="no"/>
<result column="CATEGORY_CODE" property="categoryCode"/>
<result column="NAME" property="name"/>
<result column="PRICE" property="price"/>
<result column="STOCK" property="stock"/>
<result column="CONTENT" property="content"/>
</resultMap>


<select id="orderList" resultMap="orderResultMap">
SELECT *
FROM MEMBER_ORDER
</select>

<select id="cartList" resultMap="productResultMap">

</select>

<insert id="order" parameterType="orderDto"
useGeneratedKeys="true" keyProperty="no">
<selectKey keyProperty="no" resultType="int" order="BEFORE">
	SELECT SEQ_MEMBER_ORDER_NO.NEXTVAL 
	FROM DUAL
</selectKey>
INSERT INTO MEMBER_ORDER
VALUE(NO, MEMBER_ID,ORDER_DATE,TOTAL_PRICE,RECEIVER_NAME,RECEIVER_PHONE,POST,ADDRESS
	,ADDRESS_DETAIL,REQUEST,STATE_CODE)
VALUES(#{no} ,#{memberId}, SYSDATE, #{totalPrice}, #{receiverName}, #{receiverPhone}, #{post}, #{address}
, #{addressDetail}, #{request}, 1);
</insert>

<!-- <insert id="orderDetail" parameterType="java.util.List"> -->
<!-- INSERT INTO ORDER_DETAIL -->
<!-- VALUE(NO,ORDER_NO,PRODUCT_NO,AMOUNT,PRICE) -->
<!-- VALUES -->
<!-- <foreach collection="list" separator="," item="detail"> -->
<!-- 	(SEQ_ORDER_DETAIL_NO.NEXTVAL, #{detail.orderNo}, #{detail.productNo}, #{detail.amount}, #{detail.price}) -->
<!-- </foreach> -->
<!-- </insert> -->

<!-- <select id="lastOrder" resultType="orderDto"> -->
<!-- SELECT * -->
<!-- FROM (SELECT * -->
<!-- 		FROM MEMBER_ORDER -->
<!-- 		WHERE MEMBER_ID = #{memberId} -->
<!-- 		ORDER BY ORDER_DATE DESC)  -->
<!-- WHERE <![CDATA[ ROWNUM <= 1 ]]> -->
<!-- </select> -->


</mapper>