<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mealmaker.babiyo.ranking">

<select id="toDayList" resultType="String">
SELECT NAME
FROM(SELECT P.NAME , COUNT(*) COUNT
	FROM ORDER_DETAIL D JOIN MEMBER_ORDER O
	ON D.ORDER_NO = O.NO
	JOIN PRODUCT P
	ON D.PRODUCT_NO = P.NO
	WHERE O.ORDER_DATE > SYSDATE - 1
	AND O.STATE_CODE = 2
	GROUP BY D.PRODUCT_NO, P.NAME
	HAVING COUNT(*) > 0
	ORDER BY COUNT DESC)
	WHERE <![CDATA[ ROWNUM <= 10 ]]>
</select>

<select id="weeklyList" resultType="String">
SELECT NAME
FROM(SELECT P.NAME , COUNT(*) COUNT
	FROM ORDER_DETAIL D JOIN MEMBER_ORDER O
	ON D.ORDER_NO = O.NO
	JOIN PRODUCT P
	ON D.PRODUCT_NO = P.NO
	WHERE O.ORDER_DATE > SYSDATE - 7
	AND O.STATE_CODE = 2
	GROUP BY D.PRODUCT_NO, P.NAME
	HAVING COUNT(*) > 0
	ORDER BY COUNT DESC)
	WHERE <![CDATA[ ROWNUM <= 10 ]]>
</select>

<select id="manList" resultType="String">
SELECT NAME
FROM(SELECT P.NAME , COUNT(*) COUNT
	FROM ORDER_DETAIL D JOIN MEMBER_ORDER O
	ON D.ORDER_NO = O.NO
	JOIN PRODUCT P
	ON D.PRODUCT_NO = P.NO
	JOIN MEMBER M
	ON O.MEMBER_ID = M.ID
	WHERE M.GENDER = '남'
	AND O.STATE_CODE = 2
	GROUP BY D.PRODUCT_NO, P.NAME
	HAVING COUNT(*) > 0
	ORDER BY COUNT DESC)
	WHERE <![CDATA[ ROWNUM <= 10 ]]>
</select>

<select id="womanList" resultType="String">
SELECT NAME
FROM(SELECT P.NAME , COUNT(*) COUNT
	FROM ORDER_DETAIL D JOIN MEMBER_ORDER O
	ON D.ORDER_NO = O.NO
	JOIN PRODUCT P
	ON D.PRODUCT_NO = P.NO
	JOIN MEMBER M
	ON O.MEMBER_ID = M.ID
	WHERE M.GENDER = '여'
	AND O.STATE_CODE = 2
	GROUP BY D.PRODUCT_NO, P.NAME
	HAVING COUNT(*) > 0
	ORDER BY COUNT DESC)
	WHERE <![CDATA[ ROWNUM <= 10 ]]>
</select>


</mapper>